<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>아카데미 미궁 탐사 - Labyrinth Academy</title>

    <!-- PWA 메타 태그 -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="미궁 아카데미">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="아카데미 미궁 탐사 로그라이크 연애 시뮬레이션 RPG">

    <!-- 매니페스트 -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS 아이콘 -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- 스타일 시트 -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="gameContainer">
        <header>
            <h1>Labyrinth Academy</h1>
            <div id="timeDisplay">
                <span id="dayCount">Day 1</span>
                <span id="timePhase">낮 - 아카데미</span>
            </div>
        </header>

        <main>
            <div id="gameScreen">
                <div id="academyScreen" class="screen active">
                    <div id="characterButtons" class="character-select-menu">
                        <button onclick="game.talkToCharacter('heroineA')">검술 천재</button>
                        <button onclick="game.talkToCharacter('heroineB')">마법 영재</button>
                        <button onclick="game.talkToCharacter('heroineC')">신비한 사서</button>
                    </div>

                    <div id="locationDisplay">
                        <h2 id="currentLocation">교실</h2>
                    </div>

                    <div id="storyText" class="text-box">
                        <p>평범한 아카데미 생활을 시작한 당신은 이곳에서 특별한 운명을 마주하게 됩니다...</p>
                    </div>

                    <div id="characterInteraction" class="hidden">
                        <img id="characterSprite" src="" alt="Character">
                        <div id="dialogueBox" class="text-box">
                            <h3 id="characterName"></h3>
                            <p id="dialogueText"></p>
                        </div>
                    </div>

                    <div id="academyActions" class="action-buttons">
                        <button onclick="game.moveToLocation('classroom')">교실</button>
                        <button onclick="game.moveToLocation('library')">도서관</button>
                        <button onclick="game.moveToLocation('training')">훈련장</button>
                        <button onclick="game.moveToLocation('dormitory')">기숙사</button>
                    </div>
                </div>

                <div id="labyrinthScreen" class="screen hidden">
                    <div id="dungeonInfo">
                        <h2>미궁 탐사 - <span id="floorNumber">1층</span></h2>
                    </div>

                    <div id="battleArea" class="hidden">
                        <div id="enemyDisplay">
                            <h3 id="enemyName">몬스터</h3>
                            <div class="hp-bar">
                                <div id="enemyHpBar" class="hp-fill"></div>
                                <span id="enemyHpText">HP: 100/100</span>
                            </div>
                        </div>

                        <div id="battleLog" class="text-box">
                            <p>전투 시작!</p>
                        </div>

                        <div id="battleActions" class="action-buttons">
                            <button onclick="game.battle.attack()">공격</button>
                            <button onclick="game.battle.useSkill()">스킬</button>
                            <button onclick="game.battle.useItem()">아이템</button>
                            <button onclick="game.battle.flee()">도망</button>
                        </div>
                    </div>

                    <div id="explorationArea">
                        <div id="roomDescription" class="text-box">
                            <p>미궁의 입구에 도착했습니다.</p>
                        </div>

                        <div id="explorationActions" class="action-buttons">
                            <button onclick="game.labyrinth.moveNorth()">북쪽</button>
                            <button onclick="game.labyrinth.moveSouth()">남쪽</button>
                            <button onclick="game.labyrinth.moveEast()">동쪽</button>
                            <button onclick="game.labyrinth.moveWest()">서쪽</button>
                            <button onclick="game.labyrinth.exitLabyrinth()">미궁 탈출</button>
                        </div>
                    </div>
                </div>
            </div>

            <aside id="statusPanel">
                <div id="playerStats">
                    <h3>플레이어 스탯</h3>
                    <div class="stat-item">
                        <span>HP:</span>
                        <div class="stat-bar">
                            <div id="playerHpBar" class="hp-fill"></div>
                            <span id="playerHpText">100/100</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span>MP:</span>
                        <div class="stat-bar">
                            <div id="playerMpBar" class="mp-fill"></div>
                            <span id="playerMpText">50/50</span>
                        </div>
                    </div>
                    <div class="stat-item">
                        <span>지력:</span>
                        <span id="intStat">10</span>
                    </div>
                    <div class="stat-item">
                        <span>매력:</span>
                        <span id="charmStat">10</span>
                    </div>
                    <div class="stat-item">
                        <span>체력:</span>
                        <span id="strStat">10</span>
                    </div>
                    <div class="stat-item">
                        <span>EXP:</span>
                        <span id="expStat">0</span>
                    </div>
                </div>

                <div id="relationshipStatus">
                    <h3>호감도</h3>
                    <div class="relationship-item">
                        <span>검술 천재:</span>
                        <div class="affection-bar">
                            <div id="heroineAAffection" class="affection-fill"></div>
                            <span id="heroineAAffectionText">0</span>
                        </div>
                    </div>
                    <div class="relationship-item">
                        <span>마법 영재:</span>
                        <div class="affection-bar">
                            <div id="heroineBAffection" class="affection-fill"></div>
                            <span id="heroineBAffectionText">0</span>
                        </div>
                    </div>
                    <div class="relationship-item">
                        <span>신비한 사서:</span>
                        <div class="affection-bar">
                            <div id="heroineCAffection" class="affection-fill"></div>
                            <span id="heroineCAffectionText">0</span>
                        </div>
                    </div>
                </div>

                <div id="inventory">
                    <h3>인벤토리</h3>
                    <div id="inventoryList"></div>
                </div>
            </aside>
        </main>

        <div id="modalOverlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2 id="modalTitle">알림</h2>
                <p id="modalText"></p>
                <button onclick="game.closeModal()">확인</button>
            </div>
        </div>
    </div>

    <script src="game.js"></script>
    <script>
        // Service Worker 등록
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful:', registration);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }

        // iOS에서 standalone 모드 감지
        if (window.navigator.standalone === true) {
            document.body.classList.add('ios-standalone');
        }

        // 설치 프롬프트
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // 설치 버튼 표시 (옵션)
            const installButton = document.createElement('button');
            installButton.textContent = '앱으로 설치';
            installButton.className = 'install-button';
            installButton.onclick = async () => {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                deferredPrompt = null;
                installButton.remove();
            };
            document.body.appendChild(installButton);
        });

        // 화면 방향 잠금 (가로/세로 자동)
        if (screen.orientation && screen.orientation.lock) {
            screen.orientation.lock('any').catch(() => {});
        }
    </script>
</body>
</html>